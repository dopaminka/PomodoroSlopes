<!DOCTYPE html>
<html>
 <head>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Pomodoro Timer
  </title>
  <style>
   /* The following CSS styles the page to be a vertically and horizontally centered flex container */
body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
		   max-width: 800px; /* Adjust this to suit your needs */
    margin: auto;
  
        }

        /* The timerContainer holds the individual timer circles */
.timerContainer1 {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1vw;
			margin-bottom: 1vh;

        }
.timerContainer2 {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1vw;
            margin-bottom: 1vh;
        }

        /* The timerCircle elements are the clickable timer buttons */
    .timerCircle{
            width: 8vh;
            height: 8vh;
            border-radius: 50%;
            background-color: #F04C23;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2vh;
            cursor: pointer;
            user-select: none;
        }

		.timerCircleDark {
    background-color: #C03D1F;
    }

    .timerFinished {
            background-color: #000000
        }
			
			
			
.buttonsContainer1 {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1vw;
			margin-bottom: 2vh;
        }
.buttonsContainer2 {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1vw;
			margin-bottom: 2vh;
        }

        .buttonsContainer3 {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1vw;
			margin-bottom: 1vh;
        }

.timerButton {
            width: 8vh;
            height: 4vh;
            border-radius: 50%;
            background-color: #d98773;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5vh;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s;
        }
        .timerButton2 {
            width: 8vh;
            height: 4vh;
            border-radius: 50%;
            background-color: #d97389;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5vh;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s;
        }
        .timerButton3 {
            width: 8vh;
            height: 4vh;
            border-radius: 50%;
            background-color: #7375d9;
            color: rgb(0, 0, 0);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.85vh;
            font-weight: bold;
            letter-spacing: -0.2px;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s;
        }

        .timerButton:hover {
            background-color: #C03D1F;
        }
		
        input[type="text"],
textarea {
    font-size: 16px; /* or larger */
}
  </style>
 </head>
 <body>
  <div style="display: flex; flex-direction: column; ">
   <!-- Add your title field here -->
   <div style="text-align: center">
    <label for="title" id="titleLabel">
     Title | estimation:
    </label>
    <br/>
    <input id="title" onchange="changeTitle()" style="width: 300px" type="text"/>
   </div>
   <div style="display: flex; flex-direction: column; Margin-top:2vw">
    <!-- Add your text field for notes here -->
    <div style="text-align: center; margin-bottom: 2vw;">
     <label for="notes" style="display: block; margin-bottom: 1vw;">
      Notes | steps:
     </label>
     <textarea cols="35" id="notes" rows="12"></textarea>
    </div>
    <!-- Here are the timer circles, each with a data-time attribute specifying its duration in seconds -->
    <div class="timerContainer1">

     <div class="timerCircle" data-time="1">
      0:01
     </div>
     <div class="timerCircle" data-time="10">
      0:10
     </div>
     <div class="timerCircle" data-time="30">
      0:30
     </div>
     <button class="timerButton2" id="changeSound">
        Change Sound
       </button>
    </div>
    <div class="buttonsContainer1">

     <button class="timerButton" id="btn1">
      ✔/↻
     </button>
     <button class="timerButton" id="btn2">
      ✔/↻
     </button>
     <button class="timerButton" id="btn3">
      ✔/↻
     </button>
     <button class="timerButton2" id="volumeControl">
        Volume Control
    </button>

    </div>
    <div class="timerContainer2">
     <div class="timerCircle" data-time="60">
      1:00
     </div>
     <div class="timerCircle" data-time="180">
      3:00
     </div>
     <div class="timerCircle" data-time="360">
      6:00
     </div>
     <div class="timerCircle" data-time="600">
      10:00
     </div>
     <div class="timerCircle" data-time="1200">
      20:00
     </div>
    </div>
    <div class="buttonsContainer2">
     <button class="timerButton" id="btn6">
      ✔/↻
     </button>
     <button class="timerButton" id="btn7">
      ✔/↻
     </button>
     <button class="timerButton" id="btn8">
      ✔/↻
     </button>
     <button class="timerButton" id="btn9">
      ✔/↻
     </button>
     <button class="timerButton" id="btn10">
      ✔/↻
     </button>
    </div>
    <div class="buttonsContainer3">
    

     <button class="timerButton3" id="stopwatchDisplay">
        0:00
       </button>
       <button class="timerButton3" id="stopwatchReset">
        ↻ ST
     </button>
    <button class="timerButton3" id="exportBtn">
    Exp T
    </button>
    <button class="timerButton2" id="Done">
        Done ✔
        </button>
    </div>
    <!-- The timerEndSound plays when the timer reaches 0 -->
    <audio id="timerEndSound" preload="auto" src="rimshot.mp3">
    </audio>
    <!-- The whiteNoise plays continuously while the timer is running -->
    <audio id="whiteNoise" loop="" preload="auto" src="bgm_FastTicking.mp3">
    </audio>
    <script>
     window.onload = function() {
    var timerEndSound = document.getElementById('timerEndSound');
    var whiteNoise = document.getElementById('whiteNoise');

    timerEndSound.play();
    timerEndSound.pause();

    whiteNoise.play();
    whiteNoise.pause();
}

   class Timer {
    constructor(circle) {
        this.circle = circle;
        this.countdown = null;
        this.paused = false;
        this.pausedTime = 0;
        this.remainingTime = parseInt(circle.dataset.time);
        this.initialTime = this.remainingTime;
        this.startTime = null; // Start time of the timer
        this.circle.addEventListener('click', () => this.handleClick());
        this.updateDisplay();
        this.completed = false;
    }

    handleClick() {
        this.circle.classList.remove('timerFinished');
        if (this.countdown && !this.paused) {
            this.paused = true;
            clearInterval(this.countdown);
            this.countdown = null;
            document.getElementById("whiteNoise").pause();
            this.pausedTime = this.remainingTime;
        } else if (this.paused) {
            this.paused = false;
            this.remainingTime = this.pausedTime;
            this.startCountdown();
            document.getElementById("whiteNoise").play();
        } else {
            this.startCountdown();
            document.getElementById("whiteNoise").play();
        }
    }

    startCountdown() {
        if (this.countdown) return; 

        this.startTime = Date.now() - (this.initialTime - this.remainingTime) * 1000;
        this.countdown = setInterval(() => {
            this.remainingTime = this.initialTime - Math.floor((Date.now() - this.startTime) / 1000);

            if (this.remainingTime <= 0) {
                this.complete();
                return;
            }

            this.updateDisplay();
        }, 1000);

        this.updateDisplay();
    }

   complete() {
    if (this.countdown) {
        clearInterval(this.countdown);
        this.countdown = null;
        document.getElementById("whiteNoise").pause();
    }
    this.remainingTime = 0;
    this.updateDisplay();
    this.circle.classList.add('timerFinished');
    this.paused = false;
    this.completed = true;
    
    // Add these lines to play the sound
    setTimeout(function() {
        document.getElementById("timerEndSound").play();
    }, 100);

        // Add this line to update the stopwatch's elapsed time
        stopwatch.elapsedTime += this.initialTime;
        stopwatch.updateDisplay();

}

    reset() {
        if (this.countdown) {
            clearInterval(this.countdown);
            this.countdown = null;
            document.getElementById("whiteNoise").pause();
        }
        this.remainingTime = this.initialTime;
        this.paused = false;
        this.updateDisplay();
        this.completed = false;
        this.circle.classList.remove('timerFinished');
    }

    updateDisplay() {
        const minutes = Math.floor(this.remainingTime / 60);
        const remainderSeconds = this.remainingTime % 60;
        const display = `${minutes}:${remainderSeconds < 10 ? '0' : ''}${remainderSeconds}`;
        this.circle.textContent = display;

        const percentage = this.remainingTime / this.initialTime;
        const colorValue = Math.floor(percentage * 255);
        this.circle.style.backgroundColor = `rgb(${colorValue}, 0, 0)`;
    }
}

function changeTitle() {
    var title = document.getElementById('title').value;
    document.title = title;
}

const timerCircles = document.querySelectorAll('.timerCircle');
const timers = Array.from(timerCircles).map(circle => new Timer(circle));

const timerButtons = document.querySelectorAll('.timerButton');
timerButtons.forEach((button, index) => {
    button.addEventListener('click', () => {
        if (!timers[index].completed) {
            timers[index].complete();
        } else {
            timers[index].reset();
        }
    });
});

document.getElementById('Done').addEventListener('click', function() {
    var title = document.getElementById('title').value;
    document.title = '✔✔✔✔ ' + title + ' is done!';

document.getElementById('titleLabel').textContent = "✔✔✔✔ Done:"

});


// Add this in your JavaScript script
var sounds = ['bgm_FastTicking.ogg', '31-Ocean-10min.mp3'];
var currentSound = 1;

document.getElementById('changeSound').addEventListener('click', function() {
    var whiteNoise = document.getElementById('whiteNoise');

    // change the source to a different audio file
    whiteNoise.src = sounds[currentSound];

    // call load() to ensure the new audio file is loaded
    whiteNoise.load();

    // cycle to the next sound
    currentSound = (currentSound + 1) % sounds.length;
    
      // Start playing the new sound
      whiteNoise.play();
});



class Stopwatch {
    constructor(display) {
        this.display = display;
        this.countup = null;
        this.running = false;
        this.elapsedTime = 0;
        this.updateDisplay();
    }

    startStop() {
        if (this.countup) {
            this.stop();
        } else {
            this.start();
        }
    }

    start() {
        if (this.countup) return;

        const startTime = Date.now() - this.elapsedTime * 1000;
        this.countup = setInterval(() => {
            this.elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            this.updateDisplay();
        }, 1000);

        document.getElementById("whiteNoise").play();
        this.running = true;
    }

    stop() {
        if (this.countup) {
            clearInterval(this.countup);
            this.countup = null;
            document.getElementById("whiteNoise").pause();
        }
        this.running = false;
    }

    reset() {
        this.stop();
        this.elapsedTime = 0;
        this.updateDisplay();
    }

    updateDisplay() {
    const hours = Math.floor(this.elapsedTime / 3600);
    const minutes = Math.floor((this.elapsedTime % 3600) / 60);
    const seconds = this.elapsedTime % 60;
    const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    this.display.textContent = display;
}


}



const stopwatchDisplay = document.getElementById('stopwatchDisplay');
const stopwatch = new Stopwatch(stopwatchDisplay);

stopwatchDisplay.addEventListener('click', () => stopwatch.startStop());

const stopwatchReset = document.getElementById('stopwatchReset');
stopwatchReset.addEventListener('click', () => stopwatch.reset());

// Add the volume control code here
var volumeLevels = [1, 0.20, 0.05, 0];
var currentVolume = 1;

document.getElementById('volumeControl').addEventListener('click', function() {
    var timerEndSound = document.getElementById('timerEndSound');
    var whiteNoise = document.getElementById('whiteNoise');

    // Change the volume level
    timerEndSound.volume = volumeLevels[currentVolume];
    whiteNoise.volume = volumeLevels[currentVolume];

    // Cycle to the next volume level
    currentVolume = (currentVolume + 1) % volumeLevels.length;
});
    
function exportToClipboard() {
    // Get the stopwatch display value
    var stopwatchTime = document.getElementById('stopwatchDisplay').textContent;

    // Copy the stopwatch display value to the clipboard
    navigator.clipboard.writeText(stopwatchTime);
    }
    
    document.getElementById("exportBtn").addEventListener("click", exportToClipboard);
displayTopics(); // Initialize the display of the topics
    </script>
   </div>
  </div>
 </body>
</html>