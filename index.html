<!DOCTYPE html>
<html>
<head>
    <title>Pomodoro Timer</title>
    <style>
        /* The following CSS styles the page to be a vertically and horizontally centered flex container */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        /* The timerContainer holds the individual timer circles */
        .timerContainer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* The timerCircle elements are the clickable timer buttons */
        .timerCircle{
            width: 56.6px;
            height: 56.6px;
            border-radius: 50%;
            background-color: #F04C23;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            cursor: pointer;
            user-select: none;
        }
		.timerCircleDark {
    background-color: #C03D1F;
}

.timerFinished {
            background-color: #000000;
    </style>
</head>
<body>
     <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh;">
        <!-- Add your text field for notes here -->
        <div style="text-align: center; margin-bottom: 20px;">
            <label for="notes">Notes / Wish:</label><br>
            <textarea id="notes" rows="8" cols="50"></textarea>
        </div>
    <!-- Here are the timer circles, each with a data-time attribute specifying its duration in seconds -->
    <div class="timerContainer">
	        <div class="timerCircle" data-time="1">0:01</div>
	        <div class="timerCircle" data-time="10">0:10</div>

        <div class="timerCircle" data-time="30">0:30</div>
        <div class="timerCircle" data-time="60">1:00</div>
        <div class="timerCircle" data-time="180">3:00</div>
        <div class="timerCircle" data-time="360">6:00</div>
        <div class="timerCircle" data-time="600">10:00</div>
        <div class="timerCircle" data-time="1200">20:00</div>
    </div>

    <!-- The timerEndSound plays when the timer reaches 0 -->
<audio id="timerEndSound" src="alm_BicycleBell.ogg" preload="auto"></audio>

    <!-- The whiteNoise plays continuously while the timer is running -->
<audio id="whiteNoise" src="bgm_FastTicking.ogg" preload="auto" loop></audio>

<script>
    class Timer {
        constructor(circle) {
            this.circle = circle;
            this.countdown = null;
            this.paused = false;
            this.pausedTime = 0;
            this.remainingTime = parseInt(circle.dataset.time);
            this.initialTime = this.remainingTime;
            this.circle.addEventListener('click', () => this.handleClick());
            this.updateDisplay();
        }

        handleClick() {
            if (this.countdown) {
                this.paused = !this.paused;
                if (this.paused) {
                    clearInterval(this.countdown);
                    this.countdown = null;
                    this.pausedTime = this.remainingTime;
                    document.getElementById("whiteNoise").pause();
                } else {
                    this.remainingTime = this.pausedTime;
                    this.startCountdown();
                    document.getElementById("whiteNoise").play();
                }
            } else {
                this.startCountdown();
                document.getElementById("whiteNoise").play();
            }
        }

        startCountdown() {
            this.updateDisplay();

            this.countdown = setInterval(() => {
                this.remainingTime--;

                if (this.remainingTime < 0) {
                    clearInterval(this.countdown);
                    this.countdown = null;
                    this.circle.classList.add('timerFinished');

                    const whiteNoise = document.getElementById("whiteNoise");
                    whiteNoise.pause();
                    whiteNoise.currentTime = 0; // Reset the white noise for the next play

                    setTimeout(function() {
                        document.getElementById("timerEndSound").play();
                    }, 100); // Delay the end sound by 100ms
                    
                    return;
                }

                this.updateDisplay();
            }, 1000);
        }

        updateDisplay() {
            const minutes = Math.floor(this.remainingTime / 60);
            const remainderSeconds = this.remainingTime % 60;
            const display = `${minutes}:${remainderSeconds < 10 ? '0' : ''}${remainderSeconds}`;
            this.circle.textContent = display;

            // calculate the percentage of remaining time to initial time
            const percentage = this.remainingTime / this.initialTime;
            // interpolate the color from red to black based on the remaining time
            const colorValue = Math.floor(percentage * 255);
            this.circle.style.backgroundColor = `rgb(${colorValue}, 0, 0)`;
        }
    }

    const timerCircles = document.querySelectorAll('.timerCircle');
    timerCircles.forEach(circle => new Timer(circle));
</script>
</body>
</html>
